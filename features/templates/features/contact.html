{% extends 'features/base.html' %}
{% block title %}Contact | Together for Our Village{% endblock %}
{% block content %}
{% include 'features/partials/hero.html' with hero_title="Contact Us" hero_subtitle="Have a question, suggestion, or want to get involved? Reach out to us!" hero_bg_url="https://images.unsplash.com/photo-1488521787991-ed7bbaae773c?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8ZG9uYXRpb258ZW58MHx8MHx8fDA%3D=rb-4.0.3&auto=format&fit=crop&w=2070&q=80" %}

<style>
  /* === Input field styling === */
  input[type="text"],
  input[type="email"],
  input[type="file"],
  select,
  textarea {
    background-color: #f3f4f6; /* gray-100 */
    color: #111827; /* gray-900 */
    border: 1px solid #d1d5db; /* gray-300 */
    border-radius: 0.375rem; /* rounded-md */
    padding: 0.5rem 0.75rem;
    width: 100%;
  }

  input:focus,
  textarea:focus,
  select:focus {
    outline: none;
    border-color: #16a34a; /* green-600 */
    box-shadow: 0 0 0 1px #16a34a;
  }

  /* === Dark mode === */
  .dark input[type="text"],
  .dark input[type="email"],
  .dark input[type="file"],
  .dark select,
  .dark textarea {
    background-color: #1f2937; /* gray-800 */
    color: #f9fafb; /* gray-50 */
    border-color: #374151; /* gray-700 */
  }
</style>

<div class="container mx-auto px-4 sm:px-6 py-8">
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- Contact Form -->
    <div>
      <form method="post" enctype="multipart/form-data" class="contact-form bg-white dark:bg-gray-900 p-6 rounded-lg shadow-lg" novalidate>
        {% csrf_token %}
        <h3 class="text-2xl font-bold mb-6 text-gray-800 dark:text-gray-100">Send us a Message</h3>

        {% if instructions %}
          <p class="mb-4 text-sm text-gray-600 dark:text-gray-400">{{ instructions }}</p>
        {% endif %}

        {% if form.non_field_errors %}
          <div class="mb-4 p-4 rounded bg-red-100 dark:bg-red-800 text-red-700 dark:text-red-300">
            {% for error in form.non_field_errors %}
              <p>{{ error }}</p>
            {% endfor %}
          </div>
        {% endif %}

        <!-- Name -->
        <div class="mb-4">
          <label for="id_name" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Name</label>
          {{ form.name }}
          {% if form.name.errors %}
            <p class="mt-1 text-sm text-red-600">{{ form.name.errors|join:', ' }}</p>
          {% else %}
            <p class="mt-1 text-sm text-gray-500">Please enter your full name.</p>
          {% endif %}
        </div>

        <!-- Email -->
        <div class="mb-4">
          <label for="id_email" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Email</label>
          {{ form.email }}
          {% if form.email.errors %}
            <p class="mt-1 text-sm text-red-600">{{ form.email.errors|join:', ' }}</p>
          {% else %}
            <p class="mt-1 text-sm text-gray-500">Weâ€™ll only use this to reply to you.</p>
          {% endif %}
        </div>

        <!-- Subject -->
        <div class="mb-4">
          <label for="id_subject" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Subject</label>
          {{ form.subject }}
          {% if form.subject.errors %}
            <p class="mt-1 text-sm text-red-600">{{ form.subject.errors|join:', ' }}</p>
          {% endif %}
        </div>

        <!-- Category -->
        <div class="mb-4">
          <label for="id_category" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Category (optional)</label>
          {{ form.category }}
          <p class="mt-1 text-sm text-gray-500">Helps us route your inquiry.</p>
        </div>

        <!-- Message -->
        <div class="mb-6">
          <label for="id_message" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Message</label>
          {{ form.message }}
          <div class="mt-1 flex items-center justify-between">
            {% if form.message.errors %}
              <p class="text-sm text-red-600">{{ form.message.errors|join:', ' }}</p>
            {% else %}
              <p id="messageHelp" class="text-sm text-gray-500">Share details so we can help you better.</p>
            {% endif %}
            <span id="messageCount" class="text-sm text-gray-400">0 / 2000</span>
          </div>
        </div>

        <!-- Attachment -->
        <div class="mb-4">
          <label for="id_attachment" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Attachment (optional)</label>
          {{ form.attachment }}
          {% if form.attachment.errors %}
            <p class="mt-1 text-sm text-red-600">{{ form.attachment.errors|join:', ' }}</p>
          {% else %}
            <p class="mt-1 text-sm text-gray-500">Accepted: JPG, PNG, PDF. Max 5MB.</p>
          {% endif %}
        </div>

        <!-- CAPTCHA -->
        <div class="mb-6">
          <label for="id_captcha" class="block text-sm font-medium text-gray-700 dark:text-gray-300">CAPTCHA: What is {{ captcha_question }}?</label>
          {{ form.captcha }}
          {% if form.captcha.errors %}
            <p class="mt-1 text-sm text-red-600">{{ form.captcha.errors|join:', ' }}</p>
          {% else %}
            <p class="mt-1 text-sm text-gray-500">This helps prevent spam.</p>
          {% endif %}
        </div>

        <!-- Submit -->
        <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition">Send Message</button>
      </form>
    </div>

    <!-- Contact Details -->
    <div class="flex flex-col space-y-6">
      <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-lg shadow-lg">
        <h4 class="text-xl font-bold mb-4 text-gray-800 dark:text-gray-100">Contact Details</h4>
        <ul class="text-gray-700 dark:text-gray-300 space-y-3">
          <li><span class="font-semibold">Mobile:</span> <a href="tel:+911234567890" class="hover:text-green-600">+91 12345 67890</a></li>
          <li><span class="font-semibold">WhatsApp:</span> <a href="https://wa.me/911234567890" target="_blank" class="hover:text-green-600">+91 12345 67890</a></li>
          <li><span class="font-semibold">Email:</span> <a href="mailto:villagefundraiser@email.com" class="hover:text-green-600">villagefundraiser@email.com</a></li>
          <li><span class="font-semibold">Join our WhatsApp Group:</span> <a href="#" target="_blank" class="hover:text-green-600">Click here</a></li>
          <li><span class="font-semibold">Follow us:</span> <a href="#" target="_blank" class="hover:text-green-600">Facebook</a> | <a href="#" target="_blank" class="hover:text-green-600">Instagram</a></li>
        </ul>
      </div>

      <!-- Map Embed -->
      <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-lg shadow-lg">
        <h4 class="text-xl font-bold mb-4 text-gray-800 dark:text-gray-100">Find Us</h4>
        <div class="aspect-video rounded-lg overflow-hidden">
          <iframe title="Village location" class="w-full h-full" loading="lazy" referrerpolicy="no-referrer-when-downgrade" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d31517.415308222!2d77.5946!3d12.9716!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2z12.9716LCA3Ny41OTQ2!5e0!3m2!1sen!2sin!4v1680000000000"></iframe>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const message = document.getElementById('id_message');
    const count = document.getElementById('messageCount');
    const maxLen = 2000;

    function updateCount() {
      if (!message) return;
      const len = message.value.length;
      count.textContent = `${len} / ${maxLen}`;
      count.classList.toggle('text-red-500', len > maxLen);
    }
    if (message) {
      message.addEventListener('input', updateCount);
      updateCount();
    }
  });
</script>
{% endblock %}
